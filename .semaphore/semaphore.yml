version: v1.0
name: Demo CI pipeline
agent:
  machine:
    type: f1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Build
    task:
      jobs:
        - name: Make app
          commands:
            - checkout
            - make app
            - echo hello
  - name: Tests
    task:
      prologue:
        commands:
          - checkout
      jobs:
        - name: Run app
          commands:
            - chmod +x app
            - ./app
        - name: Lint
          commands:
            - sudo apt-get update && sudo apt-get install -y cppcheck
            - make lint
        - name: Unit tests
          commands:
            - make test
